<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/iron-autogrow-textarea/iron-autogrow-textarea.html">
<link rel="import" href="../bower_components/iron-image/iron-image.html">
<link rel="import" href="../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../bower_components/iron-media-query/iron-media-query.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/paper-fab/paper-fab.html">
<link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../bower_components/paper-input/paper-input.html">
<link rel="import" href="../bower_components/paper-item/paper-item.html">
<link rel="import" href="../bower_components/paper-item/paper-item-body.html">
<link rel="import" href="../bower_components/paper-item/paper-icon-item.html">
<link rel="import" href="../bower_components/neon-animation/neon-animation.html">
<link rel="import" href="../moe-style/moe-style.html">
<dom-module id="moe-board-header">
    <style>
    :host {
        display: block;
        box-sizing: border-box;
    }
    
    :host,
    #titleItem {
        @apply(--layout);
        @apply(--layout-horizontal);
    }
    /* 手機介面 : <768px */
    
    :host([mobile]),
    :host([mobile]) #titleItem {
        @apply(--layout-vertical);
    }
    
    :host([mobile]) #form {
        max-width: 100%;
    }
    /* 發文模式 */
    
    :host([mode-publish]) {}
    
    :host([mode-publish]) #introduction,
    :host([mode-publish]) #introductionItem {
        transition: all 0.5s ease-out;
        margin: 0;
        min-height: 0;
        height: 0px;
    }
    
    :host([mode-publish]) #textarea {
        background-color: #fff;
    }
    
    :host([mode-publish]) #form #textareaControl {
        display: block;
        @apply(--layout-horizontal);
        @apply(--layout-horizontal-reverse);
    }
    
    #introduction {
        transition: all 1s;
        max-height: 5.4em;
        line-height: 1.8;
        overflow: hidden;
    }
    
    #boardLogo {
        margin: 0 auto;
    }
    
    #textarea {
        display: block;
        transition: all 1s;
        background-color: #eee;
        width: 100%;
    }
    
    #form {
        padding: 0 16px;
        max-width: 450px;
    }
    
    #form #textareaControl {
        display: none;
    }
    
    .container {
        padding: 8px 0;
    }
    </style>
    <template>
        <!-- Media Query -->
        <iron-media-query id="mediaLandscape" query="(max-width:768px) and (orientation:landscape)"></iron-media-query>
        <iron-media-query id="mediaPortrait" query="(max-width:768px) and (orientation:portrait)"></iron-media-query>
        <iron-media-query id="mediaDesktop" query="(min-width:769px)"></iron-media-query>
        <!-- Main -->
        <iron-image id="boardLogo" src="../img/logo.png" width="300" height="300" sizing="contain"></iron-image>
        <div id="headerContent" class="flex">
            <div class="container">
                <paper-item id="titleItem">
                    <div class="flex">
                        <h1>{{boardName}}</h1>
                    </div>
                    <div class="layout horizontal">
                        <paper-fab icon="favorite" mini title="heart"></paper-fab>
                        <paper-button class="primary" mini raised >機能</paper-button>
                    </div>
                </paper-item>
            </div>
            <paper-item id="introductionItem" class="flex">
                <p id="introduction"></p>
            </paper-item>
            <div id="form" class="container">
                <!-- moe-form -->
                <iron-autogrow-textarea id="textarea" on-click="_onPulish" rows="3"></iron-autogrow-textarea>
                <div id="textareaControl" class="container">
                    <paper-button mini raised>Submit</paper-button>
                    <paper-button mini on-click="_unPulish">Cancel</paper-button>
                </div>
            </div>
        </div>
    </template>
</dom-module>
<script>
Polymer({

    is: 'moe-board-header',

    behaviors: [
        Polymer.NeonAnimationRunnerBehavior
    ],

    properties: {
        boardName: {
            type: String,
            value: '艦隊これくしょん'
        },
        introduction: {
            type: Object,
            value: '『艦隊これくしょん -艦これ-』は、DMM.comと角川ゲームスが共同開発した、新しいタイプのソーシャルゲームです。<br />旧日本軍の駆逐艦や軽巡洋艦、重巡洋艦を擬人化した「艦娘（かんむす）」で、艦隊を編成、育成、強化しながら、無敵の連合艦隊を目指す育成シミュレーションゲームです。'
        },
        animationConfig: {
            type: Object,
            value: function() {
                return {
                    'entry': [],
                    'exit': [{
                        name: 'slide-up-animation',
                        node: this.$.introductionItem

                    }, {
                        name: 'fade-out-animation',
                        node: this.$.introductionItem
                    }, {
                        name: 'fade-out-animation',
                        node: this.$.boardLogo
                    }]
                };
            }
        }
    },

    listeners: {
        'mediaDesktop.query-matches-changed': 'queryMatchesChanged',
        'mediaLandscape.query-matches-changed': 'queryMatchesChanged',
        'mediaPortrait.query-matches-changed': 'queryMatchesChanged',
        'neon-animation-finish': '_hideIntro'
    },
    _unPulish: function() {
        this.toggleAttribute('mode-publish', false, this);
        this.playAnimation('entry');
    },
    _onPulish: function(event) {
        this.fire('textarea-click');
        this._publishArticle();
    },
    _publishArticle: function() {
        this.toggleAttribute('mode-publish', true, this);
        this.playAnimation('exit');
        // this._hideIntro();
    },
    _hideIntro: function() {
        this.$.introduction.style.display = this.hasAttribute('mode-publish') ? 'none' : 'block';
    },
    // 依照介面大小調整 :host 的 Attributes (default: none; mobile-portait, mobile-landscape)
    // 這部分應該可以獨立出來做一個 moe-media-query
    // 依據介面大小調整 :host 的 class 類別
    queryMatchesChanged: function(e) {
        switch (e.srcElement.id + e.detail.value) {
            case 'mediaDesktop' + true:
                Polymer.Base.toggleAttribute('mobile', false, this);
                console.log('desktop ' + e.detail.value);
                break;
            case 'mediaLandscape' + true:

                console.log('landscape ' + e.detail.value);
                break;
            case 'mediaPortrait' + true:
                Polymer.Base.toggleAttribute('mobile', true, this);
                console.log('Portrait ' + e.detail.value);
                break;
        }
    },

    // Element Lifecycle

    ready: function() {
        // `ready` is called after all elements have been configured, but
        // propagates bottom-up. This element's children are ready, but parents
        // are not.
        //
        // This is the point where you should make modifications to the DOM (when
        // necessary), or kick off any processes the element wants to perform.

        this.$.introduction.innerHTML = this.introduction;
        this.$.textarea.set('textarea.placeholder', '點擊這裡開始發文..');
    },

    attached: function() {
        // `attached` fires once the element and its parents have been inserted
        // into a document.
        //
        // This is a good place to perform any work related to your element's
        // visual state or active behavior (measuring sizes, beginning animations,
        // loading resources, etc).
    },

    detached: function() {
        // The analog to `attached`, `detached` fires when the element has been
        // removed from a document.
        //
        // Use this to clean up anything you did in `attached`.
    }
});
</script>
